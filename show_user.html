<!DOCTYPE html>
<html>

<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>标数据工具</title>
<style type="text/css">
html{height:100%}
body{height:100%;margin:0px;padding:0px}
#container{height:100%}
</style>
<script type="text/javascript" src="https://api.map.baidu.com/api?v=2.0&ak=qsZy4fym23jPRu8maXGKsPGbjUcgznKH">
//v2.0版本的引用方式：src="http://api.map.baidu.com/api?v=2.0&ak=您的密钥"
</script>
</head>

<body>
<div id="container"></div>
<script type="text/javascript">
    function getCookie(cookie_name) {
        var name = cookie_name + "=";
        var ca = document.cookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') c = c.substring(1);
            if (c.indexOf(name) != -1) return c.substring(name.length, c.length);
        }
        return "";
    }

    var Ajax={
        get: function(url, fn) {
            // XMLHttpRequest对象用于在后台与服务器交换数据
            var xhr = new XMLHttpRequest();
            xhr.open('GET', url, true);
            xhr.onreadystatechange = function() {
                // readyState == 4说明请求已完成
                if (xhr.readyState == 4 && xhr.status == 200 || xhr.status == 304) {
                    // 从服务器获得数据
                    fn.call(this, xhr.responseText);
                }
            };
            xhr.send();
        },
        // datat应为'a=a1&b=b1'这种字符串格式，在jq里如果data为对象会自动将对象转成这种字符串格式
        post: function (url, data, fn) {
            var xhr = new XMLHttpRequest();
            xhr.open("POST", url, true);
            // 添加http头，发送信息至服务器时内容编码类型
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.setRequestHeader("X-CSRFToken", getCookie("csrftoken"));
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4 && (xhr.status == 200 || xhr.status == 304)) {
                    fn.call(this, xhr.responseText);
                }
            };
            xhr.send(JSON.stringify(data));
        }
    };
    current_uid = '';
    cur_status = 'default';




    var map = new BMap.Map("container");

    var point = new BMap.Point(120.308242, 31.588242);
    map.centerAndZoom(point, 10);
    map.enableScrollWheelZoom(true);
    map.addControl(new BMap.NavigationControl());
    map.addControl(new BMap.ScaleControl());
    map.addControl(new BMap.OverviewMapControl());
    map.addControl(new BMap.MapTypeControl());
    function getQueryString(name) {  
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");  
        var r = window.location.search.substr(1).match(reg);  
        if (r != null) return unescape(r[2]);  
        return null;  
    }  

    function ShowData(){
        // 设置默认停靠位置和偏移量
        this.defaultAnchor = BMAP_ANCHOR_TOP_LEFT;
        this.defaultOffset = new BMap.Size(10, 300);
    }
    // 通过JavaScript的prototype属性继承于BMap.Control
    ShowData.prototype = new BMap.Control();

    ShowData.prototype.initialize = function(map){
        // 创建一个DOM元素
        var div = document.createElement("div");
        // 添加文字说明
        div.appendChild(document.createTextNode("显示数据"));
        // 设置样式
        div.style.cursor = "pointer";
        div.style.border = "1px solid gray";
        div.style.backgroundColor = "white";
        // 绑定事件，点击一次放大两级
        div.onclick = function(e){
            function show_data(data) {
                data = data.split('\t');
                current_uid = data[0];
                data = data[1];
                var l = data.split(',');
                var i = 0;
                var last_point = null;
                while (i < l.length) {
                    var x = l[i].split('|');
                    console.log(x);
                    console.log(x.length);
                    if (x.length == 1) {break;}
                    var point = new BMap.Point(parseFloat(x[1]), parseFloat(x[2]));
                    var marker = new BMap.Marker(point);        // 创建标注
                    map.addOverlay(marker);
                    var timestr = '';
                    if (x[0].startsWith('20180111')) {
                        timestr = x[0].substr(8, 2) + ':' + x[0].substr(10, 2);
                    }
                    var labelgg = new BMap.Label(timestr,{offset:new BMap.Size(20,-10)});
                    marker.setLabel(labelgg);
                    if (last_point) {
                        var polyline = new BMap.Polyline([
                                point,
                                last_point
                            ],
                            {strokeColor:"blue", strokeWeight:6, strokeOpacity:0.5}
                        );
                        map.addOverlay(polyline);
                    }
                    last_point = point;
                    i ++;
                }
                map.centerAndZoom(point, 8);
                cur_status = 'data_loaded'
            }
            Ajax.get("{% url 'showdata_temp:get_data_by_uid' %}"+"?uid="+getQueryString('uid'), show_data);
        };
        // 添加DOM元素到地图中
        map.getContainer().appendChild(div);
        // 将DOM元素返回
        return div;
    };
//    var my_show_data = new ShowData();
    // 添加到地图当中
//    map.addControl(my_show_data);



    function show_trace(ts, map) {
        l = ts.split(',');
        i = 0;
        last_point = null;
        while (i < l.length) {
            x = l[i].split('|');
            var point = new BMap.Point(parseFloat(x[2]), parseFloat(x[3]));
            var marker = new BMap.Marker(point);        // 创建标注
            map.addOverlay(marker);
            if (last_point) {
                var polyline = new BMap.Polyline([
                        point,
                        last_point
                    ],
                    {strokeColor:"blue", strokeWeight:6, strokeOpacity:0.5}
                );
                map.addOverlay(polyline);
            }
            last_point = point;
            i ++;
        }
        map.centerAndZoom(point, 15);
    }

    function show_area(ts, map, color) {
        l = ts.split(',');
        i = 0;
        last_point = null;
        while (i < l.length) {
            x = l[i].split(' ');
            var point = new BMap.Point(parseFloat(x[0]), parseFloat(x[1]));
            var marker = new BMap.Marker(point);        // 创建标注
            //map.addOverlay(marker);
            if (last_point) {
                var polyline = new BMap.Polyline([
                        point,
                        last_point
                    ],
                    {strokeColor:color, strokeWeight:6, strokeOpacity:0.5}
                );
                map.addOverlay(polyline);
            }
            last_point = point;
            i ++;
        }
        //map.centerAndZoom(point, 15);
    }



    function MakeDataNote(){
        // 设置默认停靠位置和偏移量
        this.defaultAnchor = BMAP_ANCHOR_TOP_LEFT;
        this.defaultOffset = new BMap.Size(10, 350);
    }
    // 通过JavaScript的prototype属性继承于BMap.Control
    MakeDataNote.prototype = new BMap.Control();

    MakeDataNote.prototype.initialize = function(map){
        var div = document.createElement("div");
        div.appendChild(document.createTextNode("提交数据标记"));
        div.style.cursor = "pointer";
        div.style.border = "1px solid gray";
        div.style.backgroundColor = "white";
        div.onclick = function(e){
            var worth = confirm("该数据是否有效？（如果数据点太少是无效数据）");
            var result_show = '';
            var result_flag = '';
            var time_str = '';
            if (worth) {
                var hard = confirm("是否是疑难数据？（疑难数据指既无法确定坐了火车，也不能排除没坐）");
                if (!hard) {
                    var rail = confirm("用户是否乘火车出行？");
                    if (rail) {
                        time_str = prompt("请输入估计的起至时间(例如 08:06-17:30)");
                        result_show += '火车出行； ' + time_str;
                        result_flag = 'ra';
                    }
                    else {
                        result_show += '未乘火车; ';
                        result_flag = 'no';
                    }
                } else {
                    result_show += '疑难数据； ';
                    result_flag = 'ca';
                }
            }
            else {
                result_show += '数据无价值; ';
                result_flag = 'wo';
            }
            var note = prompt("请输入备注(如果能确定火车出行，请写估计的上车下车站点，也可写估计乘汽车，或者该用户未出市区等，也可以不填)");
            result_show += note;
            var confir = confirm('请确认数据是否正确：' + result_show);
            if (confir) {
                alert('提交数据');
                Ajax.post("{% url 'showdata_temp:data_note' %}",{user_id: current_uid , result_flag: result_flag,result: time_str, note: note}, function(data){alert(data)});
            }
            else {
                alert('数据未提交，可再次点击提交');
            }

        };
        // 添加DOM元素到地图中
        map.getContainer().appendChild(div);
        // 将DOM元素返回
        return div;
    }
    var make_data_note = new MakeDataNote();
    // 添加到地图当中
    map.addControl(make_data_note);
    
// 南京站 83201
show_area("118.801128 32.083000,118.801128 32.091728,118.792400 32.091728,118.792400 32.083000,118.801128 32.083000", map, "yellow");
// 南京南站 83201
show_area("118.803570 31.963514,118.803570 31.975985,118.791099 31.975985,118.791099 31.963514,118.803570 31.963514", map, "yellow");
// 镇江站 83211
show_area("119.435841 32.194943,119.435841 32.200939,119.429844 32.200939,119.429844 32.194943,119.435841 32.194943", map, "yellow");
// 镇江南站 83211
show_area("119.428695 32.148059,119.428695 32.155530,119.421224 32.155530,119.421224 32.148059,119.428695 32.148059", map, "yellow");
// 常州站 83204
show_area("119.976341 31.781477,119.976341 31.788936,119.968882 31.788936,119.968882 31.781477,119.976341 31.781477", map, "yellow");
// 常州北站 83204
show_area("119.959679 31.848855,119.959679 31.857755,119.950779 31.857755,119.950779 31.848855,119.959679 31.848855", map, "yellow");
// 无锡站 83202
show_area("120.310223 31.583047,120.310223 31.591890,120.301380 31.591890,120.301380 31.583047,120.310223 31.583047", map, "yellow");
// 无锡东站 83202
show_area("120.463478 31.593375,120.463478 31.601232,120.455621 31.601232,120.455621 31.593375,120.463478 31.593375", map, "yellow");
// 苏州站 83205
show_area("120.614695 31.325784,120.614695 31.333419,120.607060 31.333419,120.607060 31.325784,120.614695 31.325784", map, "yellow");
// 苏州北站 83205
show_area("120.648276 31.417052,120.648276 31.425957,120.639371 31.425957,120.639371 31.417052,120.648276 31.417052", map, "yellow");
// 上海站 83101
show_area("121.459553 31.246393,121.459553 31.253249,121.452697 31.253249,121.452697 31.246393,121.459553 31.246393", map, "yellow");
// 上海虹桥站 83101
show_area("121.323736 31.190929,121.323736 31.198349,121.316316 31.198349,121.316316 31.190929,121.323736 31.190929", map, "yellow");
//rail_way
// nanjing 
show_area('118.79946999999999946 32.08559000000000339,118.80046000000000106 32.085090000000001,118.81243999999999517 32.08254000000000161,118.81761000000000195 32.08458000000000254,118.84382999999999697 32.09163999999999817,118.86075999999999908 32.0993700000000004,118.87339000000000055 32.10846000000000089,118.8856399999999951 32.11348999999999876,118.90485999999999933 32.1246799999999979,118.93188999999999567 32.14390000000000214,118.93944999999999368 32.14538999999999902,118.96258000000000266 32.14506999999999692,118.99988999999999351 32.1476600000000019,119.01064999999999827 32.15250000000000341,119.06011999999999773 32.17116000000000042,119.06888999999999612 32.17125999999999664,119.07881999999999323 32.16832000000000136,119.09600000000000364 32.16640999999999906,119.1199799999999982 32.16758000000000095,119.13213000000000363 32.17117999999999967,119.14811000000000263 32.1717700000000022,119.27143999999999835 32.17331000000000074,119.34708000000000538 32.17727000000000004,119.37161999999999296 32.18157000000000068,119.39119999999999777 32.18807000000000329,119.41680999999999813 32.1933700000000016,119.42974999999999852 32.19769000000000148', map, 'green');
//zhenjiang
show_area('119.43475999999999715 32.19841999999999871,119.43594000000000221 32.19859000000000293,119.44841999999999871 32.19724999999999682,119.45363999999999294 32.1936499999999981,119.48040000000000305 32.17141000000000162,119.4887599999999992 32.16055999999999671,119.5058700000000016 32.13331000000000159,119.51855000000000473 32.11883999999999872,119.54712999999999568 32.09085999999999927,119.56835999999999842 32.07558999999999827,119.58314000000000021 32.06123000000000189,119.58509999999999707 32.05458999999999747,119.58481999999999346 32.04471000000000203,119.58741000000000554 32.02911000000000286,119.59790999999999883 31.98498999999999981,119.60196000000000538 31.98125999999999891,119.61275000000000546 31.97546000000000177,119.72363 31.91927000000000092,119.76005000000000678 31.89742999999999995,119.88581999999999539 31.82554999999999978,119.90752000000000521 31.81662000000000035,119.96882999999999697 31.78932000000000002', map, 'green');
//changzhou
show_area('119.97338999999999487 31.78353999999999857,119.97481000000000506 31.78158000000000172,119.98506000000000427 31.77283999999999864,120.00063000000000102 31.76351999999999975,120.18372999999999706 31.65757999999999939,120.20771000000000583 31.64718999999999838,120.21715000000000373 31.64638000000000062,120.23411000000000115 31.641490000000001,120.24536999999999409 31.63501000000000118,120.27746999999999389 31.61306000000000083,120.28824000000000183 31.60202999999999918,120.30465999999999838 31.58846000000000132', map, 'green');
//wuxi
show_area('120.30911000000000399 31.58548000000000044,120.3092099999999931 31.58541999999999916,120.32133000000000322 31.57460999999999984,120.33051000000000386 31.56201000000000079,120.36166000000000054 31.52561000000000035,120.38437999999999306 31.5042599999999986,120.57945999999999742 31.3254400000000004,120.58517999999999404 31.32457000000000136,120.596580000000003 31.32623999999999853,120.6080999999999932 31.3286200000000008', map, 'green');
//suzhou
show_area('120.61338999999999544 31.32965000000000089,120.6148900000000026 31.32993000000000094,120.66459999999999297 31.33611000000000146,120.69140000000000157 31.33623000000000047,120.70663000000000409 31.33931000000000111,120.76288999999999874 31.35423000000000116,120.87199999999999989 31.37988,120.88127000000000066 31.37887999999999877,120.88666999999999518 31.3734800000000007,120.89790000000000703 31.36708000000000141,120.90349999999999397 31.36740999999999957,120.95570999999999628 31.3673099999999998,120.96124000000000365 31.36391000000000062,120.98358000000000345 31.35437999999999903,121 31.35093000000000174,121.05280999999999381 31.34290999999999983,121.07693000000000438 31.33596000000000004,121.22504000000000701 31.29654000000000025,121.27521000000000129 31.2868700000000004,121.4523099999999971 31.25178999999999974', map, 'green');
//shanghai

//南京南
show_area('118.80051000000000272 31.97068000000000154,118.80227999999999611 31.97144000000000119,118.9156200000000041 32.02362000000000108,118.92431999999999448 32.03103999999999729,118.94011000000000422 32.04845999999999862,118.95404000000000622 32.05906000000000233,118.97128999999999621 32.06819000000000131,119.00641000000000247 32.08332999999999657,119.02206999999999937 32.08677999999999741,119.12465000000000259 32.11269000000000062,119.16310000000000002 32.1255299999999977,119.1794399999999996 32.1349700000000027,119.22456999999999994 32.15742000000000189,119.23599000000000103 32.15950999999999738,119.25821999999999434 32.1602800000000002,119.32434000000000651 32.16579999999999728,119.38040999999999769 32.16743000000000308,119.38912000000000546 32.16456000000000159,119.42171999999999343 32.15355000000000274', map, 'green');
//镇江南
    show_area('119.42701999999999884 32.15160000000000196,119.42753000000000441 32.15142000000000166,119.47777999999999565 32.13696999999999804,119.51263000000000147 32.13011999999999802,119.53479000000000099 32.12248000000000303,119.54868999999999346 32.11433000000000249,119.56597999999999615 32.10023000000000337,119.70968000000000586 31.98703000000000074,119.72862999999999545 31.97593000000000174,119.92288000000000636 31.86582999999999899,119.94119000000000597 31.85913000000000039,119.95139000000000351 31.85542999999999836', map, 'green');
//常州北
    show_area('119.95830999999999733 31.85288999999999859,119.95892000000000621 31.85266999999999982,120.09503999999999735 31.80679999999999907,120.11485000000000412 31.80331999999999937,120.15963000000000704 31.79240000000000066,120.16777999999999338 31.78725000000000023,120.18326999999999316 31.77354000000000056,120.2467500000000058 31.72209000000000145,120.25733999999999924 31.71752000000000038,120.28843000000000529 31.70741999999999905,120.31210000000000093 31.70319999999999894,120.34675000000000011 31.69354999999999833,120.3645700000000005 31.68546999999999869,120.3815400000000011 31.67436000000000007,120.4006300000000067 31.65823999999999927,120.41647000000000389 31.64087999999999923,120.45766000000000417 31.59879000000000104', map, 'green');
//无锡东
    show_area('120.46175999999999817 31.5955900000000014,120.46249000000000251 31.59502000000000166,120.49718000000000018 31.56381999999999977,120.50414999999999566 31.55281000000000091,120.56358000000000175 31.46481999999999957,120.57143999999999551 31.45974000000000004,120.60472000000000037 31.44200000000000017,120.64113999999999294 31.42269999999999897', map, 'green');
    //苏州北
    show_area('120.65245000000000175 31.41666999999999987,120.65285000000000082 31.4164299999999983,120.70350000000000534 31.38965999999999923,120.72823999999999955 31.38004000000000104,120.74866000000000099 31.37567999999999913,120.78719999999999857 31.37088999999999928,120.80751999999999668 31.37215000000000131,120.82410000000000139 31.37620000000000076,120.85684999999999434 31.3809199999999997,120.8777199999999965 31.38057999999999836,120.89311999999999614 31.37690999999999875,120.91187999999999647 31.36929999999999907,121.01327000000000567 31.3320299999999996,121.02268999999999721 31.33189000000000135,121.04216999999999871 31.33480000000000132,121.08911000000000513 31.33821999999999974,121.09881000000000029 31.33571999999999846,121.125 31.32582000000000022,121.17413000000000523 31.31059000000000125,121.21429000000000542 31.30186000000000135,121.26712000000000558 31.2867999999999995,121.27315000000000111 31.28193999999999875,121.28303999999999974 31.26940000000000097,121.28777999999999793 31.25804000000000116,121.30021000000000697 31.23617000000000132,121.30750000000000455 31.22990000000000066,121.31955999999999563 31.21528999999999954,121.32053000000000509 31.20879000000000048,121.32186000000000092 31.19647000000000148', map, 'green');
//上海虹桥
    
//南京
    //show_area('118.81243999999999517 32.08276999999999646,118.8139500000000055 32.08332999999999657,118.83541999999999916 32.09450999999999965,118.85755000000000337 32.10284000000000049', map, 'green');
//镇江
    //show_area('119.43274999999999864 32.19760000000000133,119.4350599999999929 32.19798000000000116,119.44911000000000456 32.19662999999999897,119.45555000000000234 32.19214999999999804,119.48080000000000211 32.17045000000000243,119.49002000000000123 32.15854999999999819,119.50449999999999307 32.13495000000000346,119.51823000000000263 32.118780000000001,119.55723000000000411 32.0775599999999983,119.57026999999999362 32.06844999999999857,119.58162000000000091 32.05624000000000251,119.58431000000000211 32.04876999999999754,119.58764999999999645 32.02994999999999948,119.59901000000000693 31.98413000000000039,119.60366999999999393 31.98022999999999882,119.615949999999998 31.97387000000000157,119.77992999999999313 31.88545999999999836,119.82495000000000118 31.8577300000000001,119.872169999999997 31.83224999999999838,119.90582999999999458 31.81749999999999901,119.94440000000000168 31.80390999999999835,119.96730999999999767 31.79178999999999888,119.9707300000000032 31.78799000000000063', map, 'green');
//常州
    show_area('119.97445000000000448 31.78327000000000169,119.97552000000000305 31.7819199999999995,119.98797000000000423 31.77173000000000158,120.00888000000000488 31.75874999999999915,120.13774999999999693 31.68259000000000114,120.14703000000000088 31.68072000000000088,120.16388000000000602 31.68064000000000036,120.18276000000000181 31.67733000000000132,120.19713000000000136 31.67166999999999888,120.23233999999999355 31.65439999999999898,120.24146000000000356 31.64651999999999887,120.2554800000000057 31.63040000000000163,120.26892999999999745 31.61955000000000027,120.30489000000000033 31.58937999999999846', map, 'green');
//无锡
    show_area('120.31340000000000146 31.58333000000000013,120.31391000000000702 31.58293000000000106,120.32349999999999568 31.57153999999999883,120.3815400000000011 31.50742999999999938,120.40903000000000134 31.48162999999999911,120.58064000000000249 31.32545000000000002,120.58611999999999398 31.32497000000000043,120.59893999999999892 31.32713000000000036,120.60745000000000005 31.32932999999999879', map, 'green');
//苏州
    show_area('120.61239999999999384 31.33040000000000092,120.61413000000000295 31.33072999999999908,120.66356000000000392 31.33645999999999887,120.75 31.3496699999999997,120.7632899999999978 31.35481000000000051,120.78683999999999799 31.36055999999999955,120.83755999999999631 31.37612999999999985,120.86078999999999439 31.37990999999999886,120.88040999999999769 31.38005000000000067,120.89230000000000587 31.37705000000000055,120.91454000000000235 31.36814000000000036,121.01283999999999708 31.33199000000000112,121.02209000000000572 31.33179000000000158,121.04120000000000346 31.33438999999999908,121.09028000000000702 31.33789000000000158,121.09924999999999784 31.33549000000000007,121.1280399999999986 31.32458000000000098,121.17323000000000377 31.31072999999999951,121.21223999999999421 31.30198999999999998,121.26671000000000333 31.28668000000000049,121.272980000000004 31.28180000000000049,121.28179000000000087 31.2710700000000017,121.28686000000000433 31.26003000000000043,121.30209999999999582 31.23416999999999888,121.30910000000000082 31.2283299999999997,121.31838999999999373 31.21659999999999968,121.3200300000000027 31.20962000000000103,121.31985000000000241 31.19720999999999833', map, 'green');
//上海虹桥
    
//南京南
    //show_area('118.80264999999999986 31.96959000000000017,118.80320000000000391 31.96993000000000151,118.83684999999999832 31.98697999999999908,118.85335999999999501 32,118.86190999999999462 32.01064999999999827,118.88182999999999367 32.02960000000000207,118.90361000000000047 32.05709000000000231,118.90485999999999933 32.06383999999999901', map, 'green');
//镇江
    //show_area('119.43274999999999864 32.19760000000000133,119.4350599999999929 32.19798000000000116,119.44911000000000456 32.19662999999999897,119.45555000000000234 32.19214999999999804,119.48080000000000211 32.17045000000000243,119.49002000000000123 32.15854999999999819,119.50449999999999307 32.13495000000000346,119.51823000000000263 32.118780000000001,119.55723000000000411 32.0775599999999983,119.57026999999999362 32.06844999999999857,119.58162000000000091 32.05624000000000251,119.58431000000000211 32.04876999999999754,119.58764999999999645 32.02994999999999948,119.59901000000000693 31.98413000000000039,119.60366999999999393 31.98022999999999882,119.615949999999998 31.97387000000000157,119.77992999999999313 31.88545999999999836,119.82495000000000118 31.8577300000000001,119.872169999999997 31.83224999999999838,119.90582999999999458 31.81749999999999901,119.94440000000000168 31.80390999999999835,119.96730999999999767 31.79178999999999888,119.9707300000000032 31.78799000000000063', map, 'green');
//常州
    //show_area('119.97445000000000448 31.78327000000000169,119.97552000000000305 31.7819199999999995,119.98797000000000423 31.77173000000000158,120.00888000000000488 31.75874999999999915,120.13774999999999693 31.68259000000000114,120.14703000000000088 31.68072000000000088,120.16388000000000602 31.68064000000000036,120.18276000000000181 31.67733000000000132,120.19713000000000136 31.67166999999999888,120.23233999999999355 31.65439999999999898,120.24146000000000356 31.64651999999999887,120.2554800000000057 31.63040000000000163,120.26892999999999745 31.61955000000000027,120.30489000000000033 31.58937999999999846', map, 'green');
//无锡
    //show_area('120.31340000000000146 31.58333000000000013,120.31391000000000702 31.58293000000000106,120.32349999999999568 31.57153999999999883,120.3815400000000011 31.50742999999999938,120.40903000000000134 31.48162999999999911,120.58064000000000249 31.32545000000000002,120.58611999999999398 31.32497000000000043,120.59893999999999892 31.32713000000000036,120.60745000000000005 31.32932999999999879', map, 'green');
//苏州
    //show_area('120.61239999999999384 31.33040000000000092,120.61413000000000295 31.33072999999999908,120.66356000000000392 31.33645999999999887,120.75 31.3496699999999997,120.7632899999999978 31.35481000000000051,120.78683999999999799 31.36055999999999955,120.83755999999999631 31.37612999999999985,120.86078999999999439 31.37990999999999886,120.88040999999999769 31.38005000000000067,120.89230000000000587 31.37705000000000055,120.91454000000000235 31.36814000000000036,121.01283999999999708 31.33199000000000112,121.02209000000000572 31.33179000000000158,121.04120000000000346 31.33438999999999908,121.09028000000000702 31.33789000000000158,121.09924999999999784 31.33549000000000007,121.1280399999999986 31.32458000000000098,121.17323000000000377 31.31072999999999951,121.21223999999999421 31.30198999999999998,121.37842999999999449 31.26783999999999963,121.45311999999999841 31.25104999999999933', map, 'green');
//上海
//南京南
    //show_area('118.80264999999999986 31.96959000000000017,118.80320000000000391 31.96993000000000151,118.83684999999999832 31.98697999999999908,118.85335999999999501 32,118.86190999999999462 32.01064999999999827,118.88182999999999367 32.02960000000000207,118.90361000000000047 32.05709000000000231,118.90485999999999933 32.06383999999999901', map, 'green');
//镇江:
    //show_area('119.43274999999999864 32.19760000000000133,119.4350599999999929 32.19798000000000116,119.44911000000000456 32.19662999999999897,119.45555000000000234 32.19214999999999804,119.48080000000000211 32.17045000000000243,119.49002000000000123 32.15854999999999819,119.50449999999999307 32.13495000000000346,119.51823000000000263 32.118780000000001,119.55723000000000411 32.0775599999999983,119.57026999999999362 32.06844999999999857,119.58162000000000091 32.05624000000000251,119.58431000000000211 32.04876999999999754,119.58764999999999645 32.02994999999999948,119.59901000000000693 31.98413000000000039,119.60366999999999393 31.98022999999999882,119.615949999999998 31.97387000000000157,119.77992999999999313 31.88545999999999836,119.82495000000000118 31.8577300000000001,119.872169999999997 31.83224999999999838,119.90582999999999458 31.81749999999999901,119.94440000000000168 31.80390999999999835,119.96730999999999767 31.79178999999999888,119.9707300000000032 31.78799000000000063', map, 'green');
//常州:
    //show_area('119.97445000000000448 31.78327000000000169,119.97552000000000305 31.7819199999999995,119.98797000000000423 31.77173000000000158,120.00888000000000488 31.75874999999999915,120.13774999999999693 31.68259000000000114,120.14703000000000088 31.68072000000000088,120.16388000000000602 31.68064000000000036,120.18276000000000181 31.67733000000000132,120.19713000000000136 31.67166999999999888,120.23233999999999355 31.65439999999999898,120.24146000000000356 31.64651999999999887,120.2554800000000057 31.63040000000000163,120.26892999999999745 31.61955000000000027,120.30489000000000033 31.58937999999999846', map, 'green');
//无锡:
    //show_area('120.31340000000000146 31.58333000000000013,120.31391000000000702 31.58293000000000106,120.32349999999999568 31.57153999999999883,120.3815400000000011 31.50742999999999938,120.40903000000000134 31.48162999999999911,120.58064000000000249 31.32545000000000002,120.58611999999999398 31.32497000000000043,120.59893999999999892 31.32713000000000036,120.60745000000000005 31.32932999999999879', map, 'green');
//苏州:
    //show_area('120.61239999999999384 31.33040000000000092,120.61413000000000295 31.33072999999999908,120.66356000000000392 31.33645999999999887,120.75 31.3496699999999997,120.7632899999999978 31.35481000000000051,120.78683999999999799 31.36055999999999955,120.83755999999999631 31.37612999999999985,120.86078999999999439 31.37990999999999886,120.88040999999999769 31.38005000000000067,120.89230000000000587 31.37705000000000055,120.91454000000000235 31.36814000000000036,121.01283999999999708 31.33199000000000112,121.02209000000000572 31.33179000000000158,121.04120000000000346 31.33438999999999908,121.09028000000000702 31.33789000000000158,121.09924999999999784 31.33549000000000007,121.1280399999999986 31.32458000000000098,121.17323000000000377 31.31072999999999951,121.21223999999999421 31.30198999999999998,121.26671000000000333 31.28668000000000049,121.272980000000004 31.28180000000000049,121.28179000000000087 31.2710700000000017,121.28686000000000433 31.26003000000000043,121.30209999999999582 31.23416999999999888,121.30910000000000082 31.2283299999999997,121.31838999999999373 31.21659999999999968,121.3200300000000027 31.20962000000000103,121.31985000000000241 31.19720999999999833', map, 'green');
//上海虹桥
//free way
show_area('118.82562000000000069 32.03889999999999816,118.82581999999999312 32.03889999999999816,118.8726300000000009 32.04214999999999947,118.87609000000000492 32.04551000000000016,118.88394999999999868 32.04887000000000086,118.88716999999999757 32.05395999999999646,118.89687000000000694 32.06264000000000181,118.90255000000000507 32.0630299999999977,118.96169999999999334 32.06358999999999781,118.98619999999999663 32.06080999999999648,119.03373000000000559 32.05852000000000146,119.04292999999999836 32.06109000000000009,119.0599899999999991 32.0625,119.07375999999999294 32.06049999999999756,119.08776000000000295 32.05519000000000318,119.11472000000000548 32.04847000000000179,119.13648000000000593 32.04614000000000118,119.17202000000000339 32.04536999999999836,119.23667000000000371 32.04095999999999833,119.3469300000000004 32.03654999999999831,119.36366999999999905 32.03918999999999784,119.41568999999999789 32.0504800000000003,119.44047999999999377 32.05252000000000123,119.46627999999999759 32.05490999999999957', map, 'red');
show_area('119.45606999999999687 32.05371000000000237,119.46017000000000507 32.05434000000000339,119.47970999999999719 32.05425000000000324,119.49344000000000676 32.05093000000000103,119.53125 32.04509999999999792,119.58208999999999378 32.04030999999999807,119.60823000000000604 32.03477999999999781,119.62265999999999622 32.02857999999999805,119.64011000000000706 32.01774999999999949,119.66562999999999306 31.99786999999999892,119.67512000000000683 31.98648000000000025,119.6912099999999981 31.97194999999999965,119.71025000000000205 31.95889000000000024,119.73086999999999591 31.94841999999999871,119.75503999999999394 31.93958999999999904,119.7989599999999939 31.92013000000000034,119.97502000000000066 31.84547999999999845,120.02295999999999765 31.82176000000000116,120.03794000000000608 31.81260999999999939', map, 'red');
show_area('120.03466000000000236 31.81435000000000102,120.03479000000000099 31.81428000000000011,120.0803499999999957 31.78631999999999991,120.08879000000000303 31.77749999999999986,120.13164000000000442 31.73714999999999975,120.14216999999999302 31.73164999999999836,120.16652999999999452 31.71554000000000073,120.17968000000000472 31.71049000000000007,120.19355000000000189 31.70839000000000141,120.23103000000000407 31.69958000000000098,120.25906000000000518 31.68976999999999933,120.26798999999999751 31.68343000000000131,120.3329700000000031 31.63354999999999961,120.33910000000000196 31.62497000000000114,120.35092000000000212 31.61365999999999943,120.36404000000000281 31.60545000000000115,120.37789999999999679 31.59292999999999907,120.38799000000000206 31.57933999999999841,120.3974099999999936 31.55498000000000047,120.41257000000000232 31.53685000000000116,120.42833000000000254 31.52606000000000108,120.46565999999999974 31.49646999999999863,120.47235999999999478 31.48862000000000094', map, 'red');
show_area('120.46514999999999418 31.4973300000000016,120.46565999999999974 31.49646999999999863,120.47657999999999845 31.48414000000000001,120.52433000000000618 31.42299999999999827,120.52953999999999724 31.4109000000000016,120.53870999999999469 31.39774999999999849,120.54680000000000462 31.37930000000000064,120.55885999999999569 31.35944999999999894,120.56499999999999773 31.35530999999999935,120.57753999999999905 31.35050999999999988,120.59323999999999444 31.34795000000000087,120.60868000000000677 31.34847999999999857,120.62930000000000064 31.34857999999999834', map, 'red');
show_area('120.63448999999999955 31.34799999999999898,120.63443999999999789 31.3480099999999986,120.66467000000000098 31.34516999999999953,120.68003000000000213 31.34696999999999889,120.73712000000000444 31.35686000000000107,120.75406999999999869 31.36285000000000167,120.78132999999999697 31.36929999999999907,120.79080999999999335 31.36839000000000155,120.80505999999999744 31.36340999999999823,120.85076999999999714 31.35065000000000168,120.86867999999999768 31.34956999999999994,120.97359000000000151 31.34010999999999925,120.98726000000000624 31.33557000000000059,121.01037999999999784 31.33161000000000129,121.03042999999999552 31.33141000000000176,121.05468000000000472 31.32789999999999964,121.07957000000000392 31.31998000000000104,121.11298999999999637 31.30064000000000135,121.125 31.29729000000000028,121.1426400000000001 31.28924999999999912,121.15117999999999654 31.28206000000000131,121.16628000000000043 31.2652000000000001,121.18774999999999409 31.25305000000000177,121.19768000000000541 31.25168999999999997,121.23296000000000561 31.24990999999999985,121.26891000000000531 31.25338999999999956,121.29218000000000188 31.25243000000000038,121.39507999999999299 31.24532999999999916', map, 'red');
show_area('118.84065999999999974 32.00323999999999813,118.84098000000000184 32.00294999999999845,118.86744000000000199 31.97472000000000136,118.87457999999999458 31.96246999999999971,118.88398999999999717 31.95289000000000001,118.9447100000000006 31.8867699999999985,118.95605000000000473 31.86995999999999896,118.97894999999999754 31.84147000000000105,119.00567999999999813 31.80336000000000141,119.02884000000000242 31.76407000000000025,119.02974000000000387 31.75620999999999938,119.03873000000000104 31.71746999999999872,119.04424000000000206 31.7085000000000008,119.05015000000000214 31.70540000000000092,119.05782000000000664 31.70477999999999952,119.09314999999999429 31.70495000000000019,119.10330000000000439 31.70830000000000126,119.13801999999999737 31.71620000000000061,119.14910000000000423 31.7153400000000012,119.17928999999999462 31.71603999999999957,119.23611999999999966 31.7198999999999991', map, 'red');
show_area('119.23238000000000625 31.71932999999999936,119.23265999999999565 31.71938000000000102,119.2548100000000062 31.72010999999999825,119.31721000000000288 31.72519000000000133,119.40210000000000434 31.72871999999999915,119.41267999999999461 31.72606000000000037,119.52866000000000213 31.69369000000000014,119.56645000000000323 31.68641999999999825,119.58579000000000292 31.68578000000000117,119.60390999999999906 31.68208999999999875,119.64951999999999543 31.67643999999999949,119.74053999999999576 31.66826000000000008,119.81292999999999438 31.66492999999999824,119.91991000000000156 31.65696000000000154,119.9521000000000015 31.65766999999999953,119.96810999999999581 31.66115999999999886,119.96850999999999487 31.66128000000000142', map, 'red');
show_area('119.966700000000003 31.66074000000000055,119.96721999999999753 31.6609000000000016,120.01970000000000027 31.67361000000000004,120.05137000000000569 31.68826999999999927,120.06583999999999435 31.70263999999999882,120.09644000000000119 31.7279599999999995,120.11754999999999427 31.73618000000000094,120.13057999999999481 31.73771999999999949,120.13585000000000491 31.73497000000000057,120.16478999999999644 31.71648000000000067,120.17991999999999564 31.71043999999999841,120.19320000000000448 31.70840000000000103,120.2321500000000043 31.69911000000000101,120.25969000000000619 31.68941999999999837,120.26854000000000156 31.68298000000000059,120.3350200000000001 31.63052000000000064,120.34484000000000492 31.61880000000000024,120.35612000000000421 31.61011999999999844,120.38396000000000186 31.58489000000000146,120.39067000000000007 31.57435999999999865,120.3974099999999936 31.55498000000000047,120.41257000000000232 31.53685000000000116,120.42833000000000254 31.52606000000000108,120.46565999999999974 31.49646999999999863,120.47235999999999478 31.48862000000000094', map, 'red');
//show_area('120.46514999999999418 31.4973300000000016,120.46565999999999974 31.49646999999999863,120.47657999999999845 31.48414000000000001,120.52433000000000618 31.42299999999999827,120.52953999999999724 31.4109000000000016,120.53870999999999469 31.39774999999999849,120.54680000000000462 31.37930000000000064,120.55885999999999569 31.35944999999999894,120.56499999999999773 31.35530999999999935,120.57753999999999905 31.35050999999999988,120.59323999999999444 31.34795000000000087,120.60868000000000677 31.34847999999999857,120.62930000000000064 31.34857999999999834', map, 'red');
//show_area('120.63448999999999955 31.34799999999999898,120.63443999999999789 31.3480099999999986,120.66467000000000098 31.34516999999999953,120.68003000000000213 31.34696999999999889,120.73712000000000444 31.35686000000000107,120.75406999999999869 31.36285000000000167,120.78132999999999697 31.36929999999999907,120.79080999999999335 31.36839000000000155,120.80505999999999744 31.36340999999999823,120.85076999999999714 31.35065000000000168,120.86867999999999768 31.34956999999999994,120.97359000000000151 31.34010999999999925,120.98726000000000624 31.33557000000000059,121.01037999999999784 31.33161000000000129,121.03042999999999552 31.33141000000000176,121.05468000000000472 31.32789999999999964,121.07957000000000392 31.31998000000000104,121.11298999999999637 31.30064000000000135,121.125 31.29729000000000028,121.1426400000000001 31.28924999999999912,121.15117999999999654 31.28206000000000131,121.16628000000000043 31.2652000000000001,121.18774999999999409 31.25305000000000177,121.19768000000000541 31.25168999999999997,121.23296000000000561 31.24990999999999985,121.26891000000000531 31.25338999999999956,121.29218000000000188 31.25243000000000038,121.39507999999999299 31.24532999999999916', map, 'red');
//show_area('118.84065999999999974 32.00323999999999813,118.84098000000000184 32.00294999999999845,118.86744000000000199 31.97472000000000136,118.87457999999999458 31.96246999999999971,118.88398999999999717 31.95289000000000001,118.9447100000000006 31.8867699999999985,118.95605000000000473 31.86995999999999896,118.97894999999999754 31.84147000000000105,119.00567999999999813 31.80336000000000141,119.02884000000000242 31.76407000000000025,119.02974000000000387 31.75620999999999938,119.03873000000000104 31.71746999999999872,119.04424000000000206 31.7085000000000008,119.05015000000000214 31.70540000000000092,119.05782000000000664 31.70477999999999952,119.09314999999999429 31.70495000000000019,119.10330000000000439 31.70830000000000126,119.13801999999999737 31.71620000000000061,119.14910000000000423 31.7153400000000012,119.17928999999999462 31.71603999999999957,119.23611999999999966 31.7198999999999991', map, 'red');
//show_area('119.23238000000000625 31.71932999999999936,119.23265999999999565 31.71938000000000102,119.2548100000000062 31.72010999999999825,119.31721000000000288 31.72519000000000133,119.40210000000000434 31.72871999999999915,119.41267999999999461 31.72606000000000037,119.52866000000000213 31.69369000000000014,119.56645000000000323 31.68641999999999825,119.58579000000000292 31.68578000000000117,119.60390999999999906 31.68208999999999875,119.64951999999999543 31.67643999999999949,119.74053999999999576 31.66826000000000008,119.81292999999999438 31.66492999999999824,119.91991000000000156 31.65696000000000154,119.9521000000000015 31.65766999999999953,119.96810999999999581 31.66115999999999886,119.96850999999999487 31.66128000000000142', map, 'red');
show_area('119.966700000000003 31.66074000000000055,119.96721999999999753 31.6609000000000016,120.01970000000000027 31.67361000000000004,120.05137000000000569 31.68826999999999927,120.06583999999999435 31.70263999999999882,120.09644000000000119 31.7279599999999995,120.11754999999999427 31.73618000000000094,120.14345000000000141 31.75,120.18048000000000286 31.76633999999999958,120.23931000000000324 31.78884000000000043,120.27338000000000306 31.80594999999999928,120.31149999999999523 31.81999000000000066,120.29577000000000453 31.81747999999999976,120.28261999999999432 31.81216999999999828,120.31525000000000603 31.82004999999999839,120.32724000000000331 31.81895000000000095,120.375 31.81819000000000131,120.3933799999999934 31.81480000000000175,120.43124000000000251 31.81324000000000041,120.54021000000000186 31.80574000000000012,120.56856999999999402 31.80076999999999998,120.58577999999999975 31.79455000000000098,120.6225599999999929 31.78446999999999889,120.7106200000000058 31.75578000000000145,120.6938999999999993 31.76445000000000007,120.67753000000000441 31.76914000000000016,120.72074999999999534 31.75,120.84163999999999817 31.70657999999999888,120.79946999999999946 31.7185200000000016,120.85401000000000238 31.69970999999999961,120.92849999999999966 31.67061999999999955,120.91818000000000666 31.67791000000000068,120.90478000000000236 31.68361000000000161,120.88929000000000258 31.6868799999999986,120.92918000000000234 31.67006999999999906,120.93820999999999799 31.6627900000000011,120.95709999999999695 31.65156999999999954,121.09619999999999607 31.56495999999999924,121.10092000000000212 31.55821999999999861,121.15359999999999729 31.47721999999999909,121.15546000000000504 31.46866999999999948,121.16545999999999594 31.43825999999999965,121.17266999999999655 31.42613000000000056,121.20293999999999812 31.38497999999999877,121.25497000000000014 31.3059800000000017,121.25544999999999618 31.31083999999999889,121.24990999999999985 31.28538999999999959,121.23763999999999896 31.24946999999999875,121.2404200000000003 31.24819000000000102,121.24644999999999584 31.24960000000000093,121.28327000000000169 31.25386999999999915,121.29659999999999798 31.25146000000000157,121.32205000000000439 31.25080000000000169,121.39175000000000182 31.24598999999999904,121.3950099999999992 31.24517000000000166', map, 'red');

    
            function show_datax(data) {
                data = data.split('\t');
                current_uid = data[0];
                data = data[1];
                var l = data.split(',');
                var i = 0;
                var last_point = null;
                while (i < l.length) {
                    var x = l[i].split('|');
                    console.log(x);
                    console.log(x.length);
                    if (x.length == 1) {break;}
                    var point = new BMap.Point(parseFloat(x[1]), parseFloat(x[2]));
                    var marker = new BMap.Marker(point);        // 创建标注
                    map.addOverlay(marker);
                    var timestr = '';
                    if (x[0].startsWith('20180111')) {
                        timestr = x[0].substr(8, 2) + ':' + x[0].substr(10, 2);
                    }
                    var labelgg = new BMap.Label(timestr,{offset:new BMap.Size(20,-10)});
                    marker.setLabel(labelgg);
                    if (last_point) {
                        var polyline = new BMap.Polyline([
                                point,
                                last_point
                            ],
                            {strokeColor:"blue", strokeWeight:6, strokeOpacity:0.5}
                        );
                        map.addOverlay(polyline);
                    }
                    last_point = point;
                    i ++;
                }
                map.centerAndZoom(point, 11);
                cur_status = 'data_loaded'
            }
            Ajax.get("{% url 'showdata_temp:get_data_by_uid' %}"+"?uid="+getQueryString('uid'), show_datax);

</script>
</body>
</html>
