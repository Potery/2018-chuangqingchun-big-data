#!/bin/env python3
#import get_data, save_data
import math, sys

def distant(p1, p2):
	return math.sqrt((p1[0] - p2[0]) ** 2 + (p1[1] - p2[1]) ** 2)

def distant3(p0, p1, p2):
	a = distant(p1, p2)
	b = distant(p1, p0)
	c = distant(p2, p0)
	cosb = (c ** 2 + a ** 2 - b ** 2) / (2 * a * c)
	cosc = (b ** 2 + a ** 2 - c ** 2) / (2 * a * b)
	if cosb < 0 or cosc < 0:
		return min(b, c)
	return abs((p0[0] - p1[0]) * (p1[1]-p2[1]) - (p1[0]-p2[0])*(p0[1]-p1[1])) / math.sqrt((p1[0]-p2[0])**2+(p1[1]-p2[1])**2)
	#return ((p2[1]-p1[1])*p0[0] + (p2[0]-p1[0])*p0[1] - p1[0]*p2[1] + p2[0]*p1[1]) / math.sqrt((p2[1]-p1[1]) ** 2 + (p2[0]-p1[0]) ** 2)
	#   L=  | ( x0    -    x1)   ( y1  -  y2 ) - ( x1  -  x2 ) ( y0  - y1  )| /         âˆš[(  x1-  x2)  ^2 + ( y1 - y2 ) ^ 2]
 

	#    d=[(Y2-Y1)X0           +  (X2   -X1)   Y0    -  X1Y2       +    X2Y1]     /       spr[(Y2   - Y1)  ^2     + (X2  - X1)^2]
points1 = {
'83101':{
	'hongqiao': (121.32002611111112,31.194638925925922),
	'shanghai': (121.45612497297293,31.24982124324324),
},
'83205': {
	'suzhou': (120.61087785106385,31.32960176595745),
	'suzhoubei': (120.6438236153846,31.421504615384613),
},
'83202': {
	'wuxi': (120.30580166666665,31.587468317460306),
	'wuxidong': (120.45954928571425,31.59730362857144),
},
'83204': {
	'changzhou': (119.97261186956518,31.785206695652175),
	'changzhoubei': (119.9552288888889,31.853304833333336),
},
'83211': {
	'zhenjiang': (119.43284230000002,32.19794125),
	'zhenjiangnan': (119.42495994444442,32.15179438888889)
},
'83201': {
	'nanjing': (118.79676369230769,32.087363871794864),
	'nanjingnan': (118.79733424324324,31.96974940540541),
} 
}

points = {
'83101':{
	'hongqiao': (121.32002611111112,31.194638925925922),
	'shanghai': (121.45612497297293,31.24982124324324),
	'suzhou': (120.61087785106385,31.32960176595745),
	'suzhoubei': (120.6438236153846,31.421504615384613),
},
'83205': {
	'hongqiao': (121.32002611111112,31.194638925925922),
	'shanghai': (121.45612497297293,31.24982124324324),
	'suzhou': (120.61087785106385,31.32960176595745),
	'suzhoubei': (120.6438236153846,31.421504615384613),
	'wuxi': (120.30580166666665,31.587468317460306),
	'wuxidong': (120.45954928571425,31.59730362857144),
},
'83202': {
	'suzhou': (120.61087785106385,31.32960176595745),
	'suzhoubei': (120.6438236153846,31.421504615384613),
	'wuxi': (120.30580166666665,31.587468317460306),
	'wuxidong': (120.45954928571425,31.59730362857144),
	'changzhou': (119.97261186956518,31.785206695652175),
	'changzhoubei': (119.9552288888889,31.853304833333336),
},
'83204': {
	'changzhou': (119.97261186956518,31.785206695652175),
	'changzhoubei': (119.9552288888889,31.853304833333336),
	'wuxi': (120.30580166666665,31.587468317460306),
	'wuxidong': (120.45954928571425,31.59730362857144),
	'zhenjiang': (119.43284230000002,32.19794125),
	'zhenjiangnan': (119.42495994444442,32.15179438888889),
},
'83211': {
	'changzhou': (119.97261186956518,31.785206695652175),
	'changzhoubei': (119.9552288888889,31.853304833333336),
	'zhenjiang': (119.43284230000002,32.19794125),
	'zhenjiangnan': (119.42495994444442,32.15179438888889),
	'nanjing': (118.79676369230769,32.087363871794864),
	'nanjingnan': (118.79733424324324,31.96974940540541),
},
'83201': {
	'zhenjiang': (119.43284230000002,32.19794125),
	'zhenjiangnan': (119.42495994444442,32.15179438888889),
	'nanjing': (118.79676369230769,32.087363871794864),
	'nanjingnan': (118.79733424324324,31.96974940540541),
} 
}

def process(line):
	id, data, count = line.strip().split('\t')
	data = data.split(',')
	result = ''
	last_p = None
	for d in data:
		xx = d.split('|')
		if len(xx) > 3:
			if xx[-1] in points:
				for key in points[xx[-1]]:
					if distant(points[xx[-1]][key],(float(xx[1]),float(xx[2]))) < 0.008:
						result += key+ '-' + xx[0] + ','
					elif last_p:
						try:
							disx = distant3(points[xx[-1]][key], (float(xx[1]),float(xx[2])), last_p)
							if disx < 0.02:
								result += key+ '-' + xx[0] + ','
						except ZeroDivisionError:
							pass
			last_p = (float(xx[1]),float(xx[2]))
	
	print(id + '\t' + result)



if __name__ == '__main__':
	with open(sys.argv[1]) as f:
		for l in f:
			process(l)
	exit()


